<!DOCTYPE html>
<html 
	lang="zh">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
<link rel="stylesheet" href="/css/layout.css">

		
		<title> Denoising Diffusion Probabilistic Model -  MyHexo</title>
		<link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" />
		<script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
		<!-- lazyload -->
		<script src="https://unpkg.com/lazysizes@5.1.0/lazysizes.min.js"></script>
		<!-- smooth-scrolling -->
		<script src="https://unpkg.com/smooth-scrolling.js@latest"></script>
		<!-- highlight -->
		<link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.6.0/styles/atom-one-dark.min.css" />
		<script src="//unpkg.com/@highlightjs/cdn-assets@11.6.0/highlight.min.js"></script>
		<!-- 预置 kiraicon -->
		<link rel="stylesheet" href="/lib/iconfont/iconfont.css" crossorigin />
		
			<link rel="stylesheet" href="//at.alicdn.com/t/c/font_3299330_2a7ov96q7e3.css" crossorigin />
		
		<link rel="stylesheet" href="/lib/iconfont/iconfont.css" crossorigin />
		<link
			rel="shortcut icon"
			href="https://s2.loli.net/2023/03/16/ibSuHEpRNOncYIG.jpg"
			type="image/jpg"
		/>
		<link rel="stylesheet" href="/deps/css/APlayer.min.css">
		
			
		<link rel="stylesheet" href="/style.css" />
			
		<link rel="stylesheet" href="/custom.css" />
			
		
		<script src="/deps/js/APlayer.min.js"></script>
		<script src="/deps/js/Meting.min.js"></script>
	<meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

	<body>
		<div
			class="kira-background"
			style="background-image: url('https://s2.loli.net/2023/03/16/KduMtFODsRbpNmj.png')"
		></div>
		<div class="kira-header">
    <a
        class="kira-drawer-button mdui-ripple"
        title="导航栏"
        onclick="document.querySelector('.kira-sidebar-modal').classList.add('show');document.querySelector('.kira-sidebar#sidebar').classList.add('show');"
    >
        <i class="kirafont icon-menu"></i>
    </a>
    <a href="/" title="MyHexo">
        <img
			src="https://s2.loli.net/2023/03/16/ibSuHEpRNOncYIG.jpg"
			alt="月小白"
		/>
    </a>
</div>
		<div class="kira-body">
			<div class="kira-sidebar" id="sidebar">
	<div class="kira-avatar mdui-ripple">
		<a target="_blank" rel="noopener" href="https://s2.loli.net/2023/03/16/ibSuHEpRNOncYIG.jpg" title="月小白">
			<img
				src="https://s2.loli.net/2023/03/16/ibSuHEpRNOncYIG.jpg"
				alt="月小白"
			/>
		</a>
	</div>
	<div class="kira-count">
		<div><span>文章</span>4</div>
		<div><span>标签</span>9</div>
		<div><span>分类</span>4</div>
	</div>
	<div class="kira-list">
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/"
			title="回到首页"
		>
			<i
				class="kirafont icon-home"
			></i>
			<div class="kira-list-item-content">回到首页</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/archive.html"
			title="文章归档"
		>
			<i
				class="kirafont icon-container"
			></i>
			<div class="kira-list-item-content">文章归档</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/about.html"
			title="关于本人"
		>
			<i
				class="kirafont icon-user"
			></i>
			<div class="kira-list-item-content">关于本人</div>
		</a>
		
	</div>
	<aside id="kira-sidebar">
		 <div class="kira-widget-wrap">
	<div class="kira-widget kira-social">
		<a
			class="mdui-ripple"
			href="https://space.bilibili.com/8802532"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="kirafont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/Torato-Taraka/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="kirafont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://www.zhihu.com/people/qian-zhi-hao-25-77"
			target="_blank"
			mdui-tooltip="{content: '知乎'}"
			style="
				color: rgb(30, 136, 229);
				background-color: rgba(30, 136, 229, .1);
			"
		>
			<i
				class="kirafont icon-zhihu"
			></i> </a
		>
	</div>
</div>
  
<div class="kira-widget-wrap">
  <h3 class="kira-widget-title">分类</h3>
  <div class="kira-widget">

    <ul class="category-list">

      


      

      

      <li class="category-list-item">
        <a class="category-list-link" href="/categories/学习笔记/">学习笔记</a>
        <span class="category-list-count">1</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/categories/游戏/">游戏</a>
        <span class="category-list-count">1</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/categories/生活随记-我/">生活随记,我</a>
        <span class="category-list-count">1</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/categories/生活随记-社会/">生活随记,社会</a>
        <span class="category-list-count">1</span>
      </li>

      
    </ul>

  </div>
</div>
  
<div class="kira-widget-wrap">
	<div id="randomtagcloud" class="kira-widget tagcloud kira-rainbow"><a href="/tags/DDPM/" style="font-size: 10px;">DDPM</a> <a href="/tags/Nintendo-Switch/" style="font-size: 10px;">Nintendo Switch</a> <a href="/tags/Square-Enix/" style="font-size: 10px;">Square Enix</a> <a href="/tags/diffusion/" style="font-size: 10px;">diffusion</a> <a href="/tags/generative/" style="font-size: 10px;">generative</a> <a href="/tags/%E5%AA%92%E4%BD%93/" style="font-size: 10px;">媒体</a> <a href="/tags/%E6%94%BF%E6%B2%BB/" style="font-size: 10px;">政治</a> <a href="/tags/%E7%83%AD%E7%82%B9/" style="font-size: 10px;">热点</a> <a href="/tags/%E7%A4%BC%E7%89%A9/" style="font-size: 10px;">礼物</a></div>
	
</div>

 
	</aside>
	<div class="kira-copyright">
		&copy; 2023
		<a href="/">月小白</a
		>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> &
		<!-- TODO: github 链接 -->
		<a href="https://github.com/ch1ny/kira-hexo/" target="_blank">Kira-Hexo</a>
		<br />
		
		
	</div>
</div>
<div class="kira-sidebar-modal" id="sidebar-modal" onclick="(function(self) {
	self.classList.remove('show');
	document.querySelector('.kira-sidebar.show#sidebar').classList.remove('show');
})(this)"></div>
			<div class="kira-content">
				<div id="kira-top-header"></div>
				<div class="kira-main-content">
					
<link rel="stylesheet" href="/css/kira-image.css">

<script src="/js/kira-image.js"></script>
<div class="kira-image">
    <div class="kira-image-modal">
        <div class="kira-image-header">
            <div class="kira-image-counter"></div>
            <div class="kira-image-title"></div>
            <div class="kira-image-operation">
                <div class="kira-image-operation-button" id="kira-image-operation-button-zoom">
                    <i class="kirafont icon-zoom-in"></i>
                </div>
                <div class="kira-image-operation-button" id="kira-image-operation-button-close">
                    <i class="kirafont icon-close"></i>
                </div>
            </div>
        </div>
        <div class="kira-image-container">
            <div class="kira-image-prev-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-left"></i>
                </div>
            </div>
            <div class="kira-image-list">
                <div class="kira-image-prev">
                    <img />
                </div>
                <div class="kira-image-now">
                    <img />
                </div>
                <div class="kira-image-next">
                    <img />
                </div>
            </div>
            <div class="kira-image-next-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-right"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="kira-post">
	<article>
		
		<div class="kira-post-cover">
			<img
				data-src="/images/gifts1.png"
				data-sizes="auto"
				alt="Denoising Diffusion Probabilistic Model"
				class="lazyload kira-post-cover-image disabled-kira-image"
			/>
			<h1>Denoising Diffusion Probabilistic Model</h1>
		</div>
		
		<div class="kira-post-meta kira-rainbow" style="margin:10px 0!important;">
			<a><i class="kirafont icon-calendar-fill"></i>2023年04月26日</a>
			<a><i class="kirafont icon-areachart"></i>1.1k 字</a>
			<a><i class="kirafont icon-time-circle-fill"></i>大概 5 分钟</a>
		</div>
		<h1 id="直观">直观</h1>
<p>从直观的视角看，引用苏剑林大佬的描述[1]，DDPM所做的就是将高楼大厦拆成原材料，然后从原材料再重建成高楼大厦。让模型学习拆楼的过程，知道某一时刻的状态是初始大楼经过一定步之后怎么拆出来的，这样模型就能知道每一步大概是怎么拆的，反过来也能知道该怎么建回去。</p>
<p>看意思很简单，难点在于，拆大楼的时候可能是这里拆一块砖，那里拆一块砖，随机性很强，并非是确定的过程，所以逆向重建几乎成了不可能的事。</p>
<p>因此，需要将问题建模，利用数学工具求解这一问题。</p>
<h1 id="原理">原理</h1>
<p>借鉴Lil大佬的分享[2]，我也来试图拆解一下Diffusion Model</p>
<p>首先定义一下问题，设 <span class="math inline">\(x_i \sim q(x_i),
i=0,1,...,T\)</span> ，其中 <span class="math inline">\(x_0\)</span>
是初始状态，通过前向扩散过程得到 <span class="math inline">\(x_1, x_2,
... , x_T\)</span>，已知扩散过程为</p>
<p><span class="math inline">\(x_t = a_t x_{t-1}+b_t \epsilon_{t},\
\epsilon_t \sim \mathcal{N}(\mathbf{0},\mathbf{I})\)</span></p>
<p>其中 <span class="math inline">\(\epsilon_t\)</span>
代表t时刻加入的噪声。展开后可以得到：</p>
<p><span class="math inline">\(\begin{align} x_t &amp; =a_t x_{t-1} +
b_t \epsilon_t \\ &amp;=a_t (a_{t-1} x_{t-2} + b_{t-1}\epsilon_{t-1}) +
b_t \epsilon_{t-1} \\ &amp;= \dots \\ &amp;= (a_t \cdots a_1)x_0 + (a_t
\cdots a_2)b_1\epsilon_1 + (a_t\cdots a_3)b_2\epsilon_2+\cdots+a_t
b_{t-1} \epsilon_{t-1} + b_t \epsilon_t \end{align}\)</span></p>
<p>除第一项以外，后面是多个独立同分布的正态噪声之和，利用</p>
<p><span class="math inline">\(z\sim\mathcal{N}(0,I), \
(Az+Bz+C)\sim\mathcal{N}(C, \sqrt{A^2+B^2}\mathbf{I})\)</span></p>
<p>上式可改写为</p>
<p><span class="math inline">\(x_t=(a_t\cdots a_1)x_0 +\sqrt{(a_t\cdots
a_2)^2b_1^2+\cdots+a_t^2b_{t-1}^2+b_t^2}\bar\epsilon_t,\
\bar\epsilon_t\sim\mathcal{N}(\mathbf{0},\mathbf{I})\)</span></p>
<p>而这其实也是一个正态分布，而且如果我们将系数的平方加起来的话可以得到：</p>
<p><span class="math inline">\(\begin{align} &amp;(a_t\cdots a_1)^2+(a_t
\cdots a_2)^2b_1^2+(a_t \cdots a_3)^2b_2^2+\cdots+a_t^2b_{t-1}^2+b_t^2
\\ = &amp;(a_t\cdots a_2)^2(a_1^2+b_1^2)+(a_t \cdots
a_3)^2b_2^2+\cdots+a_t^2b_{t-1}^2+b_t^2 \\ = &amp;(a_t \cdots
a_3)^2(a_2^2(a_1^2+b_1^2)+b_2^2)+\cdots+a_t^2b_{t-1}^2+b_t^2 \\ =
&amp;a_t^2(a_{t-1}^2(\cdots(a_2^2(a_1^2+b_1^2)+b_2^2)+\dots)+b_{t-1}^2)+b_t^2
\end{align}\)</span></p>
<p>如果令 <span class="math inline">\(a_i^2+b_i^2=1\)</span>
的话，就可以简化上面的平方和为1，因此所有的表达式都可以被简化</p>
<p>这就是原论文中设定 <span class="math inline">\(x_t =
\sqrt{1-\beta_t}x_{t-1}+\sqrt{\beta_t}\epsilon_t\)</span> 的原因</p>
<p>为了与原论文统一起来，下面也用原论文的设定。</p>
<p>令 <span class="math inline">\(\alpha_t = 1-\beta_t,\
\bar\alpha_t=\prod_i^t{\alpha_i}\)</span> ，则 <span class="math inline">\(x_t=\sqrt{\alpha_t}x_{t-1}+\sqrt{1-\alpha_t}\epsilon_t=\sqrt{\bar\alpha_t}x_0+\sqrt{1-\alpha_t}\bar\epsilon_t\)</span></p>
<p>上述过程也可以看作从一个高斯分布中采样，即</p>
<p><span class="math inline">\(\begin{align} &amp;x_t \sim
q(x_t|x_{t-1})=\mathcal{N}(x_t;\sqrt{\alpha_t}x_{t-1},
(1-\alpha_t)\mathbf{I}) \\ &amp;\leftrightarrow x \sim
q(x_t|x_0)=\mathcal{N}(x_t;\sqrt{\bar\alpha_t}x_0,
(1-\bar\alpha_t)\mathbf{I}) \end{align}\)</span></p>
<p>整个前向过程是一个后验估计，可以表示为：</p>
<p><span class="math inline">\(q(x_{1:T}|x_0)=\prod_{t=1}^T{q(x_t|x_{t-1})}\)</span></p>
<hr>
<p>逆向过程就是将原材料再组合成初始的大楼，我们没办法一下子做到，但是如果知道每一步应该怎么做，那给足时间，我们就能充分还原。</p>
<p>所以建模每一步逆向过程为 <span class="math inline">\(p_\theta(x_{t-1}|x_t)\)</span>,
由于扩散的每一步我们都建模成高斯分布，那不妨逆向也设成高斯分布（事实上，文献《On
the theory of stochastic processes, with particular reference to
applications》证明了如果 <span class="math inline">\(q(x_t|x_{t-1})\)</span> 满足高斯分布且 <span class="math inline">\(\beta_t\)</span> 足够小的话，<span class="math inline">\(q(x_{t-1}|x_t)\)</span>
仍然是一个高斯分布），只不过前面的参数是确定的，而后面的参数不确定。我们先记作
<span class="math inline">\(p_\theta(x_{t-1}|x_t)=\mathcal{N}(x_t-1;\mu_\theta(x_t,t),\Sigma_\theta(x_t,
t))\)</span> ，整个逆向过程则可以表示成一个联合概率分布 <span class="math inline">\(p_\theta(x_{0:T})=p(x_T)\prod_{t=1}^T{p_\theta(x_{t-1}|x_t)}\)</span></p>
<p>值得注意的是，虽然逆向的每一步我们很难知道，但是前向的每一步是知道的。</p>
<h1 id="细节点">细节点</h1>
<p>[1] <a target="_blank" rel="noopener" href="https://spaces.ac.cn/archives/9119">生成扩散模型漫谈（一）：DDPM =
拆楼 + 建楼 - 科学空间|Scientific Spaces</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://lilianweng.github.io/posts/2021-07-11-diffusion-models/#:~:text=Diffusion%20models%20are%20inspired%20by,data%20samples%20from%20the%20noise">What
are Diffusion Models? | Lil'Log (lilianweng.github.io)</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/548112711">扩散模型
Diffusion Models - 原理篇 - 知乎 (zhihu.com)</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/565901160">一文解释
Diffusion Model (一) DDPM 理论推导 - 知乎 (zhihu.com)</a></p>
<p>[5] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/525106459">由浅入深了解Diffusion
Model - 知乎 (zhihu.com)</a></p>
<p>[6] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/595866176">Diffusion
Models从入门到放弃：必读的10篇经典论文 - 知乎 (zhihu.com)</a></p>

	</article>

	 
    <div class="kira-post-copyright">
        <strong>本文作者：</strong>月小白<br>
        <strong>本文链接：</strong><a href="http://example.com/2023/04/26/DDPM/" title="http:&#x2F;&#x2F;example.com&#x2F;2023&#x2F;04&#x2F;26&#x2F;DDPM&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;example.com&#x2F;2023&#x2F;04&#x2F;26&#x2F;DDPM&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>

  
	<div class="kira-post-nav">
		<nav class="post-nav">
			      
			<!-- 先找到与当前文字相同的目录 -->
			   
			<!-- 在找到当前文章所在的 index -->
			                  
		</nav>
	</div>
	
	<div class="kira-post-meta kira-rainbow">
		
			<a class="kirafont icon-appstore-fill -link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
		
		
			<a class="kirafont icon-tag-fill -none-link" href="/tags/DDPM/" rel="tag">DDPM</a> <a class="kirafont icon-tag-fill -none-link" href="/tags/diffusion/" rel="tag">diffusion</a> <a class="kirafont icon-tag-fill -none-link" href="/tags/generative/" rel="tag">generative</a>
		
	</div>
	
	<div class="kira-post-footer">
</div>
	
</div>


				</div>
			</div>
			<div class="kira-right-column">
	<a onclick="document.querySelector('#kira-top-header').scrollIntoView({behavior: 'smooth'});" class="kira-backtotop" aria-label="回到顶部" title="回到顶部">
		<button class="mdui-fab mdui-ripple">
			<i class="kirafont icon-caret-up"></i>
		</button>
	</a>
</div>

		</div>
	</body>
</html>
